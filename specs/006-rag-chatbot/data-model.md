# Data Model for RAG Chatbot

**Branch**: `006-rag-chatbot` | **Date**: 2025-11-29 | **Spec**: [./spec.md](./spec.md)

This document defines the database schema required for the RAG Chatbot feature, based on Section 8 of the feature specification.

## Database

The chosen database is **Neon Serverless Postgres**.

## Tables

### 1. `chat_history`

This table stores the history of all user interactions with the chatbot.

**SQL Definition**:
```sql
CREATE TABLE chat_history (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(255) NOT NULL,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    sources JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_session_id ON chat_history (session_id);
```

**Column Descriptions**:

| Column     | Type                      | Description                                                                                             |
|------------|---------------------------|---------------------------------------------------------------------------------------------------------|
| `id`         | `SERIAL PRIMARY KEY`      | Unique identifier for each chat interaction record.                                                     |
| `session_id` | `VARCHAR(255) NOT NULL`   | A unique identifier for a user's session, used to retrieve conversation history.                        |
| `question`   | `TEXT NOT NULL`           | The question asked by the user.                                                                         |
| `answer`     | `TEXT NOT NULL`           | The final answer generated by the AI agent.                                                             |
| `sources`    | `JSONB`                   | A JSON array containing objects that represent the source material used for the answer. See schema below. |
| `created_at` | `TIMESTAMP WITH TIME ZONE`| The timestamp of when the record was created.                                                           |

### `sources` JSON Schema

The `sources` column contains a JSON array where each object adheres to the following structure, as defined in `research.md`:

```json
[
  {
    "text_chunk": "The specific text snippet from the book that was used as context.",
    "page_url": "/docs/chapter-name/section-name",
    "chapter": "Chapter Name",
    "section": "Section Name"
  }
]
```

This structured data enables the frontend to render citations that link directly to the relevant part of the textbook.
